<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="keyword">
	<select id="getKeywordTotalNum" parameterType="Map" resultType="Long">
		select count(*) from 
		(select name from search_keyword 
		<if test="name != null and name != ''">
			where name like '%${name}%'
		</if>
		group by name) a
		
	</select>

	<select id="getKeywordList" parameterType="Map" resultType="KeywordDTO" >
		select * from 
		(select name, count(*)countNum from search_keyword 
		<if test="name != null and name != ''">
			where name like '%${name}%'
		</if>
		group by name) a
		order by a.countNum desc
		limit ${(p.pageNum - 1) * p.numPerPage}, ${p.numPerPage}
	</select>
	
	<select id="getById" parameterType="Long" resultType="KeywordDTO">
		select * from search_keyword where id = #{keywordId}
	</select>
	
	<insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="KeywordDTO">
		INSERT INTO search_keyword(name, createTime) 
		VALUE (#{name}, now()) 
  	</insert>
</mapper>